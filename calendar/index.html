<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>จองคิวบริการ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui; background:#f7f7f7; margin:0; padding:20px; }
    .box { background:#fff; border-radius:12px; padding:20px; max-width:420px; margin:auto; }
    h2 { margin-top:0 }
    input, select, button {
      width:100%; padding:12px; margin:6px 0;
      border-radius:8px; border:1px solid #ddd; font-size:16px;
    }
    button { background:#000; color:#fff; border:none; }
    .times { display:grid; grid-template-columns:repeat(3,1fr); gap:8px; margin-top:10px; }
    .time { padding:10px; border-radius:8px; text-align:center; border:1px solid #ccc; cursor:pointer; }
    .disabled { opacity:0.3; pointer-events:none; }
    .active { background:#000; color:#fff; }
  </style>
</head>
<body>

<div class="box">
  <h2>จองคิวบริการ</h2>

  <input id="name" placeholder="ชื่อ" />
  <input id="phone" placeholder="เบอร์โทร" />
  <select id="service">
    <option>ติดตั้งไฟ</option>
    <option>ซ่อมไฟ</option>
    <option>ตรวจระบบ</option>
  </select>

  <input type="date" id="date" />

  <div id="times" class="times"></div>

  <button onclick="submitBooking()">ยืนยันการจอง</button>
</div>

<script>
const API = "https://YOUR-WORKER-URL.workers.dev";
const shop_id = "shop001";
let selectedTime = null;

const ALL_TIMES = [
  "09:00","10:00","11:00",
  "13:00","14:00","15:00",
  "16:00","17:00"
];

document.getElementById("date").addEventListener("change", loadTimes);

async function loadTimes() {
  const date = date.value;
  const res = await fetch(`${API}/bookings?shop_id=${shop_id}&date=${date}`);
  const booked = await res.json(); // ["14:00","15:00"]

  const box = document.getElementById("times");
  box.innerHTML = "";

  ALL_TIMES.forEach(t => {
    const div = document.createElement("div");
    div.className = "time";
    div.innerText = t;
    if (booked.includes(t)) div.classList.add("disabled");
    div.onclick = () => {
      document.querySelectorAll(".time").forEach(x=>x.classList.remove("active"));
      div.classList.add("active");
      selectedTime = t;
    }
    box.appendChild(div);
  });
}

async function submitBooking() {
  if (!selectedTime) return alert("เลือกเวลา");

  const data = {
    shop_id,
    name: name.value,
    phone: phone.value,
    service: service.value,
    date: date.value,
    time: selectedTime
  };

  const res = await fetch(`${API}/book`, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(data)
  });

  alert("จองสำเร็จ");
  location.reload();
}
</script>

</body>
</html>
